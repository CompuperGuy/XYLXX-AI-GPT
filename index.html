<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>XYLXX GPT-1</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="chat-window">
    <div id="messages"></div>
    <div id="input-bar">
      <textarea id="userInput" placeholder="Message XYLXX GPT-1..." rows="1"></textarea>
      <button id="sendBtn">➤</button>
    </div>
  </div>

  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>
  <script type="module">
    import { buildModel, generateReply, loadVocab } from "./model.js";

    const messages = document.getElementById("messages");
    const input = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");

    let vocab = {};
    let model;

    // ✅ Boot model
    async function init() {
      addMessage("Loading XYLXX GPT-1...", "bot");
      vocab = await loadVocab("./vocab.json");
      model = buildModel(Object.keys(vocab).length);
      addMessage("✅ Ready! Type something below.", "bot");
    }
    init();

    // ✅ Send handler
    async function handleSend() {
      const text = input.value.trim();
      if (!text) return;
      input.value = "";
      addMessage(text, "user");

      try {
        const reply = await generateReply(model, vocab, text);
        addMessage(reply, "bot");
      } catch (err) {
        console.error(err);
        addMessage("⚠️ Error: " + err.message, "bot");
      }
    }

    // ✅ Add message bubble
    function addMessage(text, who) {
      const div = document.createElement("div");
      div.className = `msg ${who}`;
      div.innerHTML = `<div class="bubble">${text}</div>`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    // ✅ Hook send button + Enter
    sendBtn.addEventListener("click", handleSend);
    input.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });
  </script>
</body>
</html>
